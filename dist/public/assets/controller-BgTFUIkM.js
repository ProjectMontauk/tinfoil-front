const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.es-CZQ91bTY.js","assets/index-1FuSQaQ_.js","assets/index-CjDhpI0Y.css"])))=>i.map(i=>d[i]);
import{s as S,n as N,g as p,a as F,_ as Q,b as v,D as z,f as K,c as L,d as M,e as Y,h as x,i as q,p as B,j as G,v as X,k as Z,l as $,u as O,t as nn,N as H}from"./index-1FuSQaQ_.js";import{U as en,S as an}from"./rpc-vJtjE4Hb.js";const A="tw:connected-wallet-params";async function tn(n,i,t){if(!cn(t))throw new Error("given params are not stringifiable");const s=await n.getItem(A);let a;if(s){try{a=JSON.parse(s)}catch{a={}}a[i]=t}else a={[i]:t};n.setItem(A,S(a))}async function sn(n,i){const t=await n.getItem(A);if(!t)return null;try{const s=JSON.parse(t);return s!=null&&s[i]?s[i]:null}catch{return null}}function cn(n){try{return S(n),!0}catch{return!1}}const R="wallet_addEthereumChain",rn=!0,P={requestedChains:"tw.wc.requestedChains",lastUsedChainId:"tw.wc.lastUsedChainId"};async function Cn(n,i,t,s,a){var g,y;const e=await V(n,t,a),c=n.walletConnect;let{onDisplayUri:o}=c||{};if(!o&&a){const C=await F(t);o=m=>{const w=C.mobile.native||C.mobile.universal;if(!w){a(m);return}const E=K(w,m).redirect;a(E)}}o&&e.events.addListener("display_uri",o);let d=c==null?void 0:c.optionalChains,r=n.chain;t==="global.safe"&&(d=J.map(p),r&&!d.includes(r)&&(r=void 0));const{rpcMap:h,requiredChain:l,optionalChains:u}=W({client:n.client,chain:r,optionalChains:d});e.session&&await e.connect({...c!=null&&c.pairingTopic?{pairingTopic:c==null?void 0:c.pairingTopic}:{},optionalChains:u,chains:l?[l.id]:void 0,rpcMap:h}),D(u,s);const f=(await e.enable())[0];if(!f)throw new Error("No accounts found on provider.");const T=N(e.chainId),_=n.chain&&n.chain.id===T?n.chain:p(T);if(n){const C={optionalChains:(g=n.walletConnect)==null?void 0:g.optionalChains,chain:n.chain,pairingTopic:(y=n.walletConnect)==null?void 0:y.pairingTopic};s&&tn(s,t,C)}return c!=null&&c.onDisplayUri&&e.events.removeListener("display_uri",c.onDisplayUri),j(f,_,e,i,s,n.client)}async function mn(n,i,t,s,a){const e=s?await sn(s,t):null,c=await V(e?{chain:e.chain,client:n.client,walletConnect:{pairingTopic:e.pairingTopic,optionalChains:e.optionalChains}}:{client:n.client,walletConnect:{}},t,a,!0),o=c.accounts[0];if(!o)throw new Error("No accounts found on provider.");const d=N(c.chainId),r=n.chain&&n.chain.id===d?n.chain:p(d);return j(o,r,c,i,s,n.client)}async function V(n,i,t,s=!1){var T,_,g,y;const a=await F(i),e=n.walletConnect,{EthereumProvider:c,OPTIONAL_EVENTS:o,OPTIONAL_METHODS:d}=await Q(async()=>{const{EthereumProvider:C,OPTIONAL_EVENTS:I,OPTIONAL_METHODS:m}=await import("./index.es-CZQ91bTY.js");return{EthereumProvider:C,OPTIONAL_EVENTS:I,OPTIONAL_METHODS:m}},__vite__mapDeps([0,1,2]));let r=e==null?void 0:e.optionalChains,h=n.chain;i==="global.safe"&&(r=J.map(p),h&&!r.includes(h)&&(h=void 0));const{rpcMap:l,requiredChain:u,optionalChains:U}=W({client:n.client,chain:h,optionalChains:r}),f=await c.init({showQrModal:(e==null?void 0:e.showQrModal)===void 0?t?!1:rn:e.showQrModal,projectId:(e==null?void 0:e.projectId)||z,optionalMethods:d,optionalEvents:o,optionalChains:U,chains:u?[u.id]:void 0,metadata:{name:((T=e==null?void 0:e.appMetadata)==null?void 0:T.name)||v().name,description:((_=e==null?void 0:e.appMetadata)==null?void 0:_.description)||v().description,url:((g=e==null?void 0:e.appMetadata)==null?void 0:g.url)||v().url,icons:[((y=e==null?void 0:e.appMetadata)==null?void 0:y.logoUrl)||v().logoUrl]},rpcMap:l,qrModalOptions:e==null?void 0:e.qrModalOptions,disableProviderPing:!0});if(f.events.setMaxListeners(Number.POSITIVE_INFINITY),s||f.session&&await f.disconnect(),i!=="walletConnect"){async function C(){var m,w,E,b;const I=((b=(E=(w=(m=f.session)==null?void 0:m.peer)==null?void 0:w.metadata)==null?void 0:E.redirect)==null?void 0:b.native)||a.mobile.native||a.mobile.universal;t&&I&&await t(I)}f.signer.client.on("session_request_sent",C),f.events.addListener("disconnect",()=>{f.signer.client.off("session_request_sent",C)})}return f}function k({provider:n,address:i,client:t}){return{address:M(i),async sendTransaction(a){const e=await n.request({method:"eth_sendTransaction",params:[{gas:a.gas?q(a.gas):void 0,value:a.value?q(a.value):void 0,from:M(i),to:a.to,data:a.data}]});return nn({client:t,walletAddress:M(i),walletType:"walletConnect",transactionHash:e,chainId:a.chainId,contractAddress:a.to??void 0,gasPrice:a.gasPrice}),{transactionHash:e}},async signMessage({message:a}){const e=typeof a=="string"?$(a):a.raw instanceof Uint8Array?O(a.raw):a.raw;return n.request({method:"personal_sign",params:[e,this.address]})},async signTypedData(a){const e=B(a),{domain:c,message:o,primaryType:d}=e,r={EIP712Domain:G({domain:c}),...e.types};X({domain:c,message:o,primaryType:d,types:r});const h=Z({domain:c??{},message:o,primaryType:d,types:r});return await n.request({method:"eth_signTypedData_v4",params:[this.address,h]})}}}function j(n,i,t,s,a,e){const c=k({provider:t,address:n,client:e});async function o(){t.removeListener("accountsChanged",r),t.removeListener("chainChanged",h),t.removeListener("disconnect",d),await t.disconnect()}function d(){D([],a),a==null||a.removeItem(P.lastUsedChainId),o(),s.emit("disconnect",void 0)}function r(l){if(l[0]){const u=k({provider:t,address:M(l[0]),client:e});s.emit("accountChanged",u),s.emit("accountsChanged",l)}else d()}function h(l){const u=p(N(l));s.emit("chainChanged",u),a==null||a.setItem(P.lastUsedChainId,String(l))}return t.on("accountsChanged",r),t.on("chainChanged",h),t.on("disconnect",d),t.on("session_delete",d),[c,i,o,l=>ln(t,l,a)]}function on(n){var i,t;return((t=(i=n.session)==null?void 0:i.namespaces[H])==null?void 0:t.methods)||[]}function dn(n){var t,s,a;return((a=(s=(t=n.session)==null?void 0:t.namespaces[H])==null?void 0:s.chains)==null?void 0:a.map(e=>Number.parseInt(e.split(":")[1]||"")))??[]}async function ln(n,i,t){var a,e;const s=i.id;try{const c=dn(n),o=on(n);if(!c.includes(s)&&o.includes(R)){const r=await Y(i),h=[...new Set([...((a=i.blockExplorers)==null?void 0:a.map(u=>u.url))||[],...((e=r.explorers)==null?void 0:e.map(u=>u.url))||[]])];await n.request({method:R,params:[{chainId:q(r.chainId),chainName:r.name,nativeCurrency:r.nativeCurrency,rpcUrls:x(r),blockExplorerUrls:h.length>0?h:void 0}]});const l=await hn(t);l.push(s),D(l,t)}await n.request({method:"wallet_switchEthereumChain",params:[{chainId:q(s)}]})}catch(c){const o=typeof c=="string"?c:c==null?void 0:c.message;throw/user rejected request/i.test(o)?new en(c):new an(c)}}function D(n,i){i==null||i.setItem(P.requestedChains,S(n))}async function hn(n){const i=await n.getItem(P.requestedChains);return i?JSON.parse(i):[]}function W(n){const i={};n.chain&&(i[n.chain.id]=L({chain:n.chain,client:n.client}));const t=((n==null?void 0:n.optionalChains)||[]).slice(0,10);for(const s of t)i[s.id]=L({chain:s,client:n.client});return!n.chain&&t.length===0&&(i[1]=p(1).rpc),{rpcMap:i,requiredChain:n.chain?n.chain:void 0,optionalChains:t.length>0?t.map(s=>s.id):[1]}}const J=[1,11155111,42161,43114,8453,1313161554,84532,56,42220,100,10,137,1101,324,534352];export{mn as autoConnectWC,Cn as connectWC};
