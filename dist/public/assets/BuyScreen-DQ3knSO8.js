import{m as Ce,w as Ie,o as ae,q as dt,r as lt,x as Ft,s as ut,y as Z,z as Ae,A as Re,B as Ot,C as t,L as ye,E as l,S as g,M as ne,I as ht,F as E,W as Pt,G as P,H as We,T as w,J as Be,K as M,O as H,P as ge,Q as _t,R as L,U as q,V as Se,X as Fe,Y as D,Z as te,$ as Te,a0 as C,a1 as fe,a2 as zt,a3 as De,a4 as tt,e as Lt,a5 as je,a6 as qt,a7 as Oe,a8 as mt,a9 as ft,aa as xt,ab as pe,ac as Pe,ad as se,ae as be,af as re,ag as yt,ah as _e,ai as kt,aj as wt,ak as Mt,al as Nt,am as $t,an as Ht,ao as gt,ap as G,aq as Ut,ar as Vt,as as jt,at as Kt,au as nt,av as ke,d as st,aw as bt,ax as Gt,ay as Qt,az as ze,g as V,aA as Yt,aB as Zt,aC as Jt,aD as Xt,aE as Tt,aF as Ct,aG as ve,aH as en,aI as we,aJ as tn,aK as Le,aL as Ee,aM as nn,aN as sn,aO as an,aP as on,aQ as St,aR as At,aS as rn,aT as at,aU as cn,aV as pt,aW as vt,aX as dn,aY as ln,aZ as un,a_ as hn,a$ as mn,b0 as fn,b1 as xn,b2 as yn,b3 as ot,b4 as kn,b5 as wn,b6 as gn,b7 as jn,b8 as xe,b9 as bn,ba as Tn,bb as Cn,bc as Sn,bd as An,be as pn,bf as vn,bg as In,bh as Wn,bi as Dn,bj as En}from"./index-1FuSQaQ_.js";import{decimals as Rn}from"./decimals-BEr_1y_N.js";import{getCurrencyMetadata as It}from"./getCurrencyMetadata-jEu-w5-9.js";import{isInsightEnabled as Bn}from"./common-ZY4eBO6r.js";import"./decimals-COvrHi8E.js";async function it(e){const n=await Ce(e);return Ie(n)}function Fn(e,n){return ae({...n,queryKey:["buyWithCryptoQuote",e],refetchInterval:2e4,queryFn:()=>{if(!e)throw new Error("Swap params are required");return dt(e)},enabled:!!e,retry:!1})}async function On(e){try{const a=await lt(e.client)(Ft(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:ut({toAddress:e.toAddress,fromCurrencySymbol:e.fromCurrencySymbol,toChainId:e.toChainId.toString(),toTokenAddress:e.toTokenAddress,fromAmount:e.fromAmount,toAmount:e.toAmount,maxSlippageBPS:e.maxSlippageBPS,isTestMode:e.isTestMode,purchaseData:e.purchaseData,fromAddress:e.fromAddress,toGasAmountWei:e.toGasAmountWei,preferredProvider:e.preferredProvider,multiHopSupported:!0})});if(!a.ok){const s=await a.json();throw s&&"error"in s?s:new Error(`HTTP error! status: ${a.status}`)}return(await a.json()).result}catch(n){throw console.error("Error getting buy with fiat quote",n),n}}function Pn(e,n){return ae({...n,queryKey:["useBuyWithFiatQuote",e],queryFn:async()=>{if(!e)throw new Error("No params provided");return On(e)},enabled:!!e,retry:!1})}function _n(e){var x,A,p,b,W,f;const{payUiOptions:n,supportedDestinations:a,client:s,onContinue:r,payerAccount:u}=e,d=Z(),i=Ae(),o=n.metadata,c=n.paymentInfo,{data:h}=Re(c.chain),{data:m}=Ot({client:s,address:c.sellerAddress}),k=ae({queryKey:["amount",c],queryFn:async()=>{let v=18;c.token&&!D(c.token)&&(v=await Rn({contract:te({address:c.token.address,chain:c.chain,client:s})}));let S;return"amountWei"in c?S=Te(c.amountWei,v):S=c.amount,S}}).data;if(!h||k===void 0)return t.jsx(ye,{});const j=c.token?{...c.token,icon:((x=c.token)==null?void 0:x.icon)||((p=(A=a.find(v=>v.chain.id===c.chain.id))==null?void 0:A.tokens.find(v=>{var S;return v.address.toLowerCase()===((S=c.token)==null?void 0:S.address.toLowerCase())}))==null?void 0:p.icon)}:{address:M,name:h.nativeCurrency.name,symbol:h.nativeCurrency.symbol,icon:(b=h.icon)==null?void 0:b.url};return t.jsxs(l,{px:"lg",children:[t.jsx(g,{y:"lg"}),t.jsx(ne,{title:(o==null?void 0:o.name)||"Payment Details"}),t.jsx(g,{y:"lg"}),t.jsxs(l,{children:[o!=null&&o.image?t.jsx(ht,{client:s,src:o==null?void 0:o.image,style:{width:"100%",borderRadius:E.md,backgroundColor:d.colors.tertiaryBg}}):i?t.jsxs(l,{flex:"row",center:"both",style:{padding:E.md,marginBottom:E.md,borderRadius:E.md,backgroundColor:d.colors.tertiaryBg},children:[t.jsx(Pt,{size:P.xl,id:i.id,client:s}),t.jsx("div",{style:{flexGrow:1,borderBottom:"6px dotted",borderColor:d.colors.secondaryIconColor,marginLeft:E.md,marginRight:E.md}}),t.jsx(We,{client:s,size:P.xl,chainIconUrl:(W=h.icon)==null?void 0:W.url})]}):null,t.jsx(g,{y:"md"}),t.jsxs(l,{flex:"row",children:[t.jsx(l,{flex:"column",expand:!0,children:t.jsx(w,{size:"md",color:"primaryText",weight:700,children:"Price"})}),t.jsx(l,{expand:!0,children:t.jsxs(l,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:[t.jsx(Be,{chain:c.chain,client:e.client,size:"sm",token:j}),t.jsxs(w,{color:"primaryText",size:"md",weight:700,children:[String(H(Number(k),6))," ",j.symbol]})]})})]}),t.jsx(g,{y:"md"}),t.jsx(ge,{}),t.jsx(g,{y:"md"}),t.jsxs(l,{flex:"row",children:[t.jsx(l,{flex:"column",expand:!0,children:t.jsx(w,{size:"xs",color:"secondaryText",children:"Network"})}),t.jsx(l,{expand:!0,children:t.jsxs(l,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:[t.jsx(We,{chainIconUrl:(f=h.icon)==null?void 0:f.url,size:"xs",client:e.client}),t.jsx(w,{size:"xs",color:"secondaryText",style:{textAlign:"right"},children:h.name})]})})]}),t.jsx(g,{y:"sm"}),t.jsxs(l,{flex:"row",children:[t.jsx(l,{flex:"column",expand:!0,children:t.jsx(w,{size:"xs",color:"secondaryText",children:"Seller"})}),t.jsx(l,{expand:!0,children:t.jsx(l,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:t.jsx(w,{size:"xs",color:"secondaryText",style:{textAlign:"right"},children:m||_t(c.sellerAddress)})})})]})]}),t.jsx(g,{y:"xl"}),u?t.jsx(L,{variant:"accent",fullWidth:!0,onClick:()=>{var v;q({event:"choose_payment_method_direct_payment_mode",client:s,walletAddress:u.address,walletType:i==null?void 0:i.id,toChainId:c.chain.id,toToken:(v=c.token)==null?void 0:v.address}),r(k,c.chain,j)},children:"Choose Payment Method"}):t.jsx("div",{children:t.jsx(Se,{...e.connectOptions,client:s,theme:d,connectButton:{style:{width:"100%"}}})}),t.jsx(g,{y:"lg"}),n.showThirdwebBranding!==!1&&t.jsxs(t.Fragment,{children:[t.jsx(Fe,{link:"https://playground.thirdweb.com/connect/pay?utm_source=ub_text"}),t.jsx(g,{y:"sm"})]})]})}function zn(e){const{transaction:n,account:a,supportedDestinations:s}=e,[r,u]=C.useState();return C.useEffect(()=>{Promise.all([fe(n.value),fe(n.erc20Value),fe(n.to),zt(n)]).then(([d,i,o,c])=>{var h;u({value:d==null?void 0:d.toString(),erc20Value:(h=i==null?void 0:i.amountWei)==null?void 0:h.toString(),erc20Currency:i==null?void 0:i.tokenAddress,to:o,data:c})})},[n]),ae({queryKey:["transaction-cost",n.chain.id,a==null?void 0:a.address,r],queryFn:async()=>{var y,k,j;if(!a)throw new Error("No payer account found");const d=await fe(n.erc20Value);if(d){const[x,A,p]=await Promise.all([De({address:a.address,chain:n.chain,client:n.client,tokenAddress:d.tokenAddress}),It({contract:te({address:d.tokenAddress,chain:n.chain,client:n.client})}),tt(n,a==null?void 0:a.address)]),b=d.amountWei,W=x;return{token:{address:d.tokenAddress,name:A.name,symbol:A.symbol,icon:(k=(y=s.find(v=>v.chain.id===n.chain.id))==null?void 0:y.tokens.find(v=>v.address.toLowerCase()===d.tokenAddress.toLowerCase()))==null?void 0:k.icon},decimals:A.decimals,walletBalance:W,gasCostWei:p,transactionValueWei:b}}const[i,o,c]=await Promise.all([De({address:a.address,chain:n.chain,client:n.client}),Lt(n.chain),tt(n,a==null?void 0:a.address)]),h=i,m=await fe(n.value)||0n;return{token:{address:M,name:o.nativeCurrency.name,symbol:o.nativeCurrency.symbol,icon:(j=o.icon)==null?void 0:j.url},decimals:18,walletBalance:h,gasCostWei:c,transactionValueWei:m}},enabled:!!n&&!!r,refetchInterval:()=>{if(!n.erc20Value)return 3e4}})}function Ln(e){var v;const{payUiOptions:n,client:a,payerAccount:s,supportedDestinations:r,onContinue:u}=e,{data:d,error:i,isLoading:o,refetch:c}=Re(n.transaction.chain),h=n.metadata,{data:m,error:y,isLoading:k,refetch:j}=zn({transaction:n.transaction,account:s,supportedDestinations:r}),x=Z(),A=Ae(),p=je(),b=qt(A),W=Oe({address:p==null?void 0:p.address,chain:n.transaction.chain,tokenAddress:D((m==null?void 0:m.token)||mt)||m==null?void 0:m.token.address,client:e.client},{enabled:!!m});if(k||o)return t.jsx(ye,{});if(!p)return t.jsx(l,{style:{minHeight:"350px"},fullHeight:!0,flex:"row",center:"both",children:t.jsxs(l,{animate:"fadein",children:[t.jsx(g,{y:"xxl"}),t.jsx(l,{flex:"row",center:"x",children:t.jsx(ft,{size:P["3xl"]})}),t.jsx(g,{y:"lg"}),t.jsx(w,{center:!0,color:"primaryText",size:"md",children:"Please connect a wallet to continue"}),t.jsx(g,{y:"xl"}),t.jsx(l,{flex:"row",center:"x",style:{width:"100%"},children:t.jsx(Se,{client:a,theme:x,...e.connectOptions})})]})});if(y||i)return t.jsx(l,{style:{minHeight:"350px"},fullHeight:!0,flex:"row",center:"both",children:t.jsx(xt,{title:(y==null?void 0:y.message)||(i==null?void 0:i.message)||"Something went wrong",onTryAgain:y?j:c})});if(!m||!d)return t.jsx(ye,{});const f=W.data&&W.data.value<m.transactionValueWei;return t.jsxs(l,{px:"lg",children:[t.jsx(g,{y:"lg"}),t.jsx(ne,{title:(h==null?void 0:h.name)||"Transaction"}),t.jsx(g,{y:"lg"}),t.jsxs(l,{children:[h!=null&&h.image?t.jsx(ht,{client:a,src:h==null?void 0:h.image,style:{width:"100%",borderRadius:E.md,border:`1px solid ${x.colors.borderColor}`,backgroundColor:x.colors.tertiaryBg}}):p?t.jsxs(l,{flex:"column",gap:"sm",children:[f&&t.jsxs("div",{children:[t.jsx(w,{color:"danger",size:"xs",center:!0,multiline:!0,children:"Insufficient Funds"}),t.jsx(w,{size:"xs",center:!0,multiline:!0,children:"Select another token or pay with card."})]}),t.jsxs(l,{flex:"row",style:{justifyContent:"space-between",padding:E.sm,marginBottom:E.sm,borderRadius:E.md,backgroundColor:x.colors.tertiaryBg,border:`1px solid ${x.colors.borderColor}`},children:[t.jsx(pe,{address:p==null?void 0:p.address,iconSize:"md",client:a}),W.data?t.jsxs(l,{flex:"row",gap:"3xs",center:"y",children:[t.jsx(w,{size:"xs",color:"secondaryText",weight:500,children:Pe(W.data,!1)}),t.jsx(se,{token:m.token,chain:n.transaction.chain,size:"xs",color:"secondaryText"})]}):t.jsx(be,{width:"70px",height:re.xs})]})]}):null,t.jsx(g,{y:"md"}),t.jsxs(l,{flex:"row",children:[t.jsx(l,{flex:"column",expand:!0,children:t.jsx(w,{size:"md",color:"primaryText",weight:700,children:"Price"})}),t.jsx(l,{expand:!0,children:t.jsxs(l,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:[t.jsx(Be,{chain:n.transaction.chain,client:e.client,size:"sm",token:m.token}),t.jsxs(w,{color:"primaryText",size:"md",weight:700,children:[String(H(Number(Te(m.transactionValueWei,m.decimals)),6))," ",m.token.symbol]})]})})]}),t.jsx(g,{y:"md"}),t.jsx(ge,{}),t.jsx(g,{y:"md"}),t.jsxs(l,{flex:"row",children:[t.jsx(l,{flex:"column",expand:!0,children:t.jsx(w,{size:"xs",color:"secondaryText",children:"Gas Fees"})}),t.jsx(l,{expand:!0,children:t.jsx(l,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:t.jsx(w,{color:b?"success":"primaryText",size:"xs",children:b?"Sponsored":`${String(H(Number(Te(m.gasCostWei,d.nativeCurrency.decimals)),6))} ${d.nativeCurrency.symbol}`})})})]}),t.jsx(g,{y:"sm"}),t.jsxs(l,{flex:"row",children:[t.jsx(l,{flex:"column",expand:!0,children:t.jsx(w,{size:"xs",color:"secondaryText",children:"Network"})}),t.jsx(l,{expand:!0,children:t.jsxs(l,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:[t.jsx(We,{chainIconUrl:(v=d.icon)==null?void 0:v.url,size:"xs",client:e.client}),t.jsx(w,{size:"xs",color:"secondaryText",style:{textAlign:"right"},children:d.name})]})})]})]}),t.jsx(g,{y:"xl"}),s?t.jsx(L,{variant:"accent",fullWidth:!0,onClick:()=>{var I;let S=f?m.transactionValueWei-(((I=W.data)==null?void 0:I.value)||0n):m.transactionValueWei;m.token.address===M&&!b&&(S+=m.gasCostWei),q({event:"choose_payment_method_transaction_mode",client:a,walletAddress:s.address,walletType:A==null?void 0:A.id,toChainId:n.transaction.chain.id,toToken:m.token.address,amountWei:S.toString()}),u(Te(S,m.decimals),n.transaction.chain,m.token)},children:"Choose Payment Method"}):t.jsx("div",{children:t.jsx(Se,{...e.connectOptions,client:a,theme:x,connectButton:{style:{width:"100%"}}})}),t.jsx(g,{y:"lg"}),n.showThirdwebBranding!==!1&&t.jsxs(t.Fragment,{children:[t.jsx(Fe,{link:"https://playground.thirdweb.com/connect/pay?utm_source=ub_text"}),t.jsx(g,{y:"sm"})]})]})}function qn(e){return t.jsxs(l,{children:[t.jsx(l,{p:"lg",children:t.jsx(ne,{title:"Pay with",onBack:e.onBack})}),t.jsx(ge,{}),t.jsx(g,{y:"lg"}),t.jsx(l,{flex:"column",gap:"xs",px:"lg",children:yt.map(n=>t.jsxs(Mn,{fullWidth:!0,variant:"secondary",onClick:()=>e.onSelect(n),gap:"sm",children:[kt(n,"lg"),t.jsxs(l,{flex:"column",gap:"xxs",children:[t.jsx(w,{color:"primaryText",children:n.shorthand}),t.jsx(w,{size:"sm",children:n.name})]})]},n.shorthand))}),t.jsx(g,{y:"lg"})]})}const Mn=_e(L)(()=>{const e=Z();return{background:e.colors.tertiaryBg,justifyContent:"flex-start",gap:E.sm,padding:E.sm,"&:hover":{background:e.colors.secondaryButtonBg,transform:"scale(1.01)"},transition:"background 200ms ease, transform 150ms ease"}});function Wt(e){return typeof e.error=="object"&&e.error.code&&e.error.code==="MINIMUM_PURCHASE_AMOUNT"?{code:"MINIMUM_PURCHASE_AMOUNT",title:"Amount Too Low",message:"The requested amount is less than the minimum purchase. Try another provider or amount."}:(console.error(e),{code:"UNABLE_TO_GET_PRICE_QUOTE",title:"Failed to Find Quote",message:"We couldn't get a quote for this token pair. Select another token or pay with card."})}const Dt=C.forwardRef(function(n,a){return t.jsx(Nn,{ref:a,children:t.jsx(Nt,{children:t.jsxs(l,{p:"lg",children:[t.jsx($t,{children:t.jsx(Ht,{type:"button","aria-label":"Close",onClick:n.close,children:t.jsx(gt,{width:P.md,height:P.md,style:{color:"inherit"}})})}),n.children]})})})}),Nn=wt(e=>{const n=Z();return{zIndex:1e4,borderTopLeftRadius:G.xl,borderTopRightRadius:G.xl,background:n.colors.modalBg,position:"absolute",bottom:0,left:0,right:0,animation:`${$n} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.1)`,borderTop:`1px solid ${n.colors.borderColor}`}}),$n=Ut`
  from {
    opacity: 0;
    transform: translateY(100px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
`,Et=wt(e=>({backgroundColor:Z().colors.modalOverlayBg,zIndex:9999,position:"absolute",inset:0,animation:`${Mt} 400ms cubic-bezier(0.16, 1, 0.3, 1)`}));function Rt(){const[e,n]=C.useState(!1),a=C.useRef(null),s=C.useRef(null),r=C.useCallback(()=>new Promise(d=>{var i;if(a.current){const o={easing:"cubic-bezier(0.175, 0.885, 0.32, 1.1)",fill:"forwards",duration:300},c=a.current.animate([{transform:"translateY(100%)",opacity:0}],o);(i=s.current)==null||i.animate([{opacity:0}],o),c.onfinish=()=>d()}else d()}),[]),u=C.useCallback(async d=>{d?n(!0):(await r(),n(!1))},[r]);return C.useLayoutEffect(()=>{if(!e)return;const d=i=>{a.current&&i.target instanceof Node&&!a.current.contains(i.target)&&u(!1)};return requestAnimationFrame(()=>{document.addEventListener("click",d)}),()=>{document.removeEventListener("click",d)}},[e,u]),{drawerRef:a,drawerOverlayRef:s,setIsOpen:u,isOpen:e}}function Hn(e){if(e>3600){const n=Math.floor(e/3600),a=Math.floor(e%3600/60);return`${n} Hours ${a} Minutes`}return e>60?`${Math.ceil(e/60)} Minutes`:`${e}s`}function Bt(e){const{estimatedSeconds:n,quoteIsLoading:a}=e;return t.jsxs(l,{bg:"tertiaryBg",flex:"row",borderColor:"borderColor",style:{borderRadius:G.md,borderTopLeftRadius:0,borderTopRightRadius:0,justifyContent:"space-between",alignItems:"center",borderWidth:"1px",borderStyle:"solid"},children:[t.jsxs(l,{flex:"row",center:"y",gap:"xxs",color:"accentText",p:"sm",children:[t.jsx(Vt,{width:P.sm,height:P.sm}),a?t.jsx(be,{height:re.xs,width:"50px",color:"borderColor"}):t.jsx(w,{size:"xs",color:"secondaryText",children:n!==void 0?`~${Hn(n)}`:"--"})]}),t.jsxs(L,{variant:"ghost",onClick:e.onViewFees,gap:"xs",children:[t.jsx(l,{color:"accentText",flex:"row",center:"both",children:t.jsx(Un,{size:P.sm})}),t.jsx(w,{size:"xs",color:"secondaryText",children:"View Fees"})]})]})}const Un=e=>t.jsxs("svg",{width:e.size,height:e.size,viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[t.jsx("path",{d:"M9.5 1.5H2.5C1.94772 1.5 1.5 1.94772 1.5 2.5V9.5C1.5 10.0523 1.94772 10.5 2.5 10.5H9.5C10.0523 10.5 10.5 10.0523 10.5 9.5V2.5C10.5 1.94772 10.0523 1.5 9.5 1.5Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),t.jsx("path",{d:"M4.5 7.5L7.5 4.5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})]});function Vn(e){return t.jsxs(l,{bg:"tertiaryBg",borderColor:"borderColor",flex:"row",style:{borderRadius:G.md,borderBottomRightRadius:0,borderBottomLeftRadius:0,borderWidth:"1px",borderStyle:"solid",borderBottom:"none",flexWrap:"nowrap",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs(Kn,{variant:"ghost",onClick:e.onSelectCurrency,style:{minHeight:"64px",justifyContent:"flex-start",minWidth:"50%"},gap:"sm",children:[kt(e.currency,"md"),t.jsxs(l,{flex:"row",center:"y",gap:"xxs",color:"secondaryText",children:[t.jsx(w,{color:"primaryText",children:e.currency.shorthand}),t.jsx(jt,{width:P.sm,height:P.sm})]})]}),t.jsx("div",{style:{flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:E.xxs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",justifyContent:"center",paddingRight:E.sm},children:e.isLoading?t.jsx(be,{width:"100px",height:re.lg}):t.jsx(w,{size:"lg",color:e.value?"primaryText":"secondaryText",children:e.value?`${e.currency.symbol}${H(Number(e.value),6)}`:"--"})})]})}const Kn=_e(L)(()=>({"&[disabled]:hover":{borderColor:"transparent"}}));function Gn(e){return t.jsx(l,{flex:"column",gap:"xs",style:{alignItems:"flex-start"},children:e.quote.processingFees.map(n=>{const a=H(Number(n.amount),6);return t.jsxs(l,{flex:"row",gap:"xxs",children:[t.jsxs(w,{color:"primaryText",size:"sm",children:[a===0?"~":"",a," ",n.token.symbol]}),t.jsxs(w,{color:"secondaryText",size:"sm",children:["($",(n.amountUSDCents/100).toFixed(2),")"]})]},`${n.token.chainId}_${n.token.tokenAddress}_${a}`)})})}function Qn(e){return t.jsxs(l,{flex:"column",gap:"xs",children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx(w,{inline:!0,color:"secondaryText",children:"Amount"}),t.jsxs(w,{color:"primaryText",inline:!0,children:[H(Number(e.quote.fromCurrency.amount),2)," ",e.quote.fromCurrency.currencySymbol]})]}),e.quote.processingFees.map((n,a)=>{const s=H(Number(n.amount),6);return t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx(w,{inline:!0,color:"secondaryText",children:n.feeType==="NETWORK"?"Network Fee":"Processing Fee"}),t.jsxs(w,{color:"primaryText",inline:!0,children:[s===0?"~":""," ",s," ",n.currencySymbol]})]},a)}),t.jsx(g,{y:"xxs"}),t.jsx(ge,{}),t.jsx(g,{y:"xxs"}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx(w,{inline:!0,color:"secondaryText",children:"Total"}),t.jsxs(w,{color:"primaryText",inline:!0,children:[H(Number(e.quote.fromCurrencyWithFees.amount),6)," ",e.quote.fromCurrencyWithFees.currencySymbol]})]})]})}const Yn=["COINBASE","STRIPE","TRANSAK","KADO"];function Zn(e){return t.jsx(l,{expand:!0,flex:"column",gap:"sm",style:{alignItems:"flex-start"},children:Yn.map(n=>t.jsx(l,{flex:"row",expand:!0,style:{justifyContent:"space-between"},children:t.jsx(L,{fullWidth:!0,onClick:()=>e.onSelect(n),variant:"link",children:t.jsx(Kt,{color:e.preferredProvider===n?"primaryText":"secondaryText",size:"sm",hoverColor:"primaryText",children:n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()})})},n))})}function Jn(e){var N,B,K,U,O,$,oe,ie,J,X;const{toToken:n,tokenAmount:a,payer:s,client:r,setScreen:u,toChain:d,showCurrencySelector:i,selectedCurrency:o}=e,h=((B=(N=e.payOptions)==null?void 0:N.paymentInfo)==null?void 0:B.sellerAddress)||e.payer.account.address,{drawerRef:m,drawerOverlayRef:y,isOpen:k,setIsOpen:j}=Rt(),[x,A]=C.useState("fees"),p=e.payOptions.buyWithFiat,[b,W]=C.useState(p!==!1?(p==null?void 0:p.preferredProvider)||(localStorage.getItem(nt)??void 0):void 0),f=Pn(p!==!1&&a?{fromCurrencySymbol:o.shorthand,toChainId:d.id,toAddress:h,toTokenAddress:D(n)?M:n.address,toAmount:a,client:r,isTestMode:p==null?void 0:p.testMode,purchaseData:e.payOptions.purchaseData,fromAddress:s.account.address,preferredProvider:b}:void 0);function v(){f.data&&u({id:"fiat-flow",quote:f.data})}function S(){f.data&&(A("fees"),j(!0))}function I(){A("providers"),j(!0)}const T=!f.data,R=!f.isLoading&&f.error?Wt(f.error):void 0;return t.jsxs(l,{flex:"column",gap:"lg",animate:"fadein",children:[k&&t.jsxs(t.Fragment,{children:[t.jsx(Et,{ref:y}),t.jsxs(Dt,{ref:m,close:()=>j(!1),children:[x==="fees"&&f.data&&t.jsxs("div",{children:[t.jsx(w,{size:"lg",color:"primaryText",children:"Fees"}),t.jsx(g,{y:"lg"}),t.jsx(Qn,{quote:f.data})]}),x==="providers"&&t.jsxs("div",{children:[t.jsx(w,{size:"lg",color:"primaryText",children:"Providers"}),t.jsx(g,{y:"lg"}),t.jsx(Zn,{preferredProvider:b||((K=f.data)==null?void 0:K.provider),onSelect:Q=>{W(Q),localStorage.setItem(nt,Q),j(!1)}})]})]})]}),t.jsxs(l,{flex:"column",gap:"sm",children:[t.jsx(w,{size:"sm",children:"Pay with card"}),t.jsxs("div",{children:[t.jsx(Vn,{isLoading:f.isLoading,value:(U=f.data)==null?void 0:U.fromCurrencyWithFees.amount,client:r,currency:o,onSelectCurrency:i}),t.jsxs(l,{bg:"tertiaryBg",flex:"row",borderColor:"borderColor",style:{paddingLeft:E.md,justifyContent:"space-between",alignItems:"center",borderWidth:"1px",borderStyle:"solid",borderBottom:"none"},children:[t.jsx(w,{size:"xs",color:"secondaryText",children:"Provider"}),t.jsx(L,{variant:"ghost",onClick:I,children:t.jsxs(l,{flex:"row",center:"y",gap:"xxs",color:"secondaryText",children:[t.jsx(w,{size:"xs",children:b?`${b.charAt(0).toUpperCase()+b.slice(1).toLowerCase()}`:(O=f.data)!=null&&O.provider?`${(($=f.data)==null?void 0:$.provider.charAt(0).toUpperCase())+((oe=f.data)==null?void 0:oe.provider.slice(1).toLowerCase())}`:""}),t.jsx(jt,{width:P.sm,height:P.sm})]})})]}),t.jsx(Bt,{quoteIsLoading:f.isLoading,estimatedSeconds:(ie=f.data)==null?void 0:ie.estimatedDurationSeconds,onViewFees:S})]}),R&&t.jsx("div",{children:(J=R.data)!=null&&J.minimumAmountEth?t.jsxs(w,{color:"danger",size:"sm",center:!0,multiline:!0,children:["Minimum amount is"," ",H(Number(R.data.minimumAmountEth),6)," ",t.jsx(se,{token:n,chain:d,size:"sm",inline:!0,color:"danger"})]}):t.jsxs("div",{children:[t.jsx(w,{color:"danger",size:"xs",center:!0,multiline:!0,children:R.title}),t.jsx(w,{size:"xs",center:!0,multiline:!0,children:R.message})]})})]}),(X=R==null?void 0:R.data)!=null&&X.minimumAmountEth?t.jsx(L,{variant:"accent",fullWidth:!0,onClick:()=>{var Q;e.setTokenAmount(H(Number((Q=R.data)==null?void 0:Q.minimumAmountEth),6).toString()),e.setHasEditedAmount(!0)},children:"Set Minimum"}):t.jsx(L,{variant:T?"outline":"accent","data-disabled":T,disabled:T,fullWidth:!0,onClick:()=>{q({event:"confirm_onramp_quote",client:r,walletAddress:s.account.address,walletType:s.wallet.id,toChainId:d.id,toToken:D(n)?void 0:n.address}),v()},gap:"xs",children:f.isLoading?t.jsxs(t.Fragment,{children:["Getting price quote",t.jsx(ke,{size:"sm",color:"accentText"})]}):"Continue"})]})}function Xn(e){const n=e.toToken.chainId===e.onRampToken.token.chainId,a=st(e.toToken.tokenAddress)===st(e.onRampToken.token.tokenAddress);return!(n&&a)}function es(e){return Xn(e)?e.routingToken?[{action:"buy",token:e.onRampToken.token,amount:e.onRampToken.amount},{action:"swap",token:e.routingToken.token,amount:e.routingToken.amount},{action:"bridge",token:e.toToken,amount:e.estimatedToAmountMin}]:[{action:"buy",token:e.onRampToken.token,amount:e.onRampToken.amount},{action:"swap",token:e.toToken,amount:e.estimatedToAmountMin}]:[{action:"buy",token:e.toToken,amount:e.estimatedToAmountMin}]}function ts(e,n){const r=(window.innerHeight-750)/2,u=(window.innerWidth-500)/2;return window.open(`${e}&theme=${n}`,"thirdweb Pay",`width=500, height=750, top=${r}, left=${u}`)}function ns(e){var u;const n=bt(),a=cs({wallet:e.payer.wallet,connectedWallets:n}),s=as({quote:e.quote,client:e.client,onSuccess:e.onSuccess,onDone:e.onDone,payer:e.payer,theme:e.theme,isAutoMode:a}),r=(u=s.steps[0])==null?void 0:u.step.token.chainId;return t.jsxs(l,{p:"lg",children:[t.jsx(ne,{title:e.title,onBack:e.onBack}),t.jsx(g,{y:"xl"}),t.jsx(l,{flex:"column",gap:"xs",center:"y",style:{paddingLeft:E.md},children:t.jsx(pe,{client:e.client,address:e.receiverAddress,iconSize:"md",textSize:"sm",label:"Recipient wallet"})}),t.jsx(g,{y:"md"}),t.jsx(l,{flex:"column",children:s.steps.map(({step:d,status:i},o)=>t.jsxs(l,{flex:"column",children:[t.jsx(Gt,{state:i,index:o,style:{flex:"1"},children:t.jsx(ss,{step:d,client:e.client,payer:e.payer,index:o})}),o<s.steps.length-1&&t.jsx(Qt,{})]},d.action))}),t.jsx(g,{y:"md"}),t.jsx(w,{size:"xs",color:"secondaryText",center:!0,style:{padding:`0 ${E.xl}`},children:"Keep this window open until all transactions are complete."}),t.jsx(g,{y:"lg"}),t.jsx(l,{flex:"column",gap:"md",children:!s.isDone&&r&&r!==e.payer.chain.id?t.jsx(ze,{fullWidth:!0,variant:"accent",switchChain:async()=>{await e.payer.wallet.switchChain(V(r))}}):t.jsxs(L,{variant:"accent",gap:"sm",fullWidth:!0,onClick:s.handleContinue,disabled:s.isLoading,children:[s.isLoading?"Processing":s.isDone?e.transactionMode?"Continue Transaction":"Done":s.isFailed?"Retry":"Continue",s.isLoading&&t.jsx(ke,{size:"sm",color:"primaryText"})]})})]})}function ss(e){const{step:n,client:a}=e,s=Tt(V(n.token.chainId));return t.jsx(l,{flex:"column",gap:"xs",py:"3xs",children:t.jsxs(l,{flex:"row",center:"y",gap:"sm",style:{display:"flex",justifyContent:"space-between",flexWrap:"nowrap"},children:[t.jsx(Ct,{chain:V(n.token.chainId),client:a,size:"md",token:{address:n.token.tokenAddress}}),t.jsxs(l,{flex:"column",gap:"3xs",center:"y",style:{flex:"1"},children:[t.jsx(w,{size:"sm",color:"primaryText",children:n.action.charAt(0).toUpperCase()+n.action.slice(1)}),t.jsxs(l,{flex:"row",gap:"xs",center:"y",style:{display:"flex",justifyContent:"space-between",flexWrap:"nowrap"},children:[t.jsxs(l,{flex:"row",gap:"xxs",center:"y",style:{flex:"1 1 60%",minWidth:0,maxWidth:"60%",overflow:"hidden",flexWrap:"nowrap"},children:[t.jsx(w,{size:"sm",color:"primaryText",children:H(Number(n.amount),5)}),t.jsx(se,{token:{address:n.token.tokenAddress,name:n.token.name||"",symbol:n.token.symbol||""},chain:V(n.token.chainId),size:"sm",color:"secondaryText"})]}),t.jsx(l,{flex:"row",gap:"xs",center:"y",style:{flex:"1 1 40%",maxWidth:"40%",minWidth:0,justifyContent:"flex-end",flexWrap:"nowrap"},children:t.jsx(w,{size:"xs",style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.name})})]})]})]})})}function as(e){const n=es(e.quote),[a,s]=C.useState(0),[r,u]=C.useState(),[d,i]=C.useState(null),{uiStatus:o}=os({intentId:e.quote.intentId,client:e.client,onSuccess:b=>{n.length===1?e.onSuccess(b):s(W=>W+1)},openedWindow:d}),c=n[a-1],h=n[a],m=rs({client:e.client,payer:e.payer}),{uiStatus:y}=is({client:e.client,transactionHash:r==null?void 0:r.hash,chainId:r==null?void 0:r.chainId,onSuccess:()=>{a===n.length-1?an({intentId:e.quote.intentId,client:e.client}).then(e.onSuccess):(u(void 0),m.reset(),s(b=>b+1))}}),k=n.map((b,W)=>{let f="unknown";return W===0?f=o:W<a?f="completed":W===a&&(m.isPending?f="pending":m.error?f="failed":r?f=y:f="actionRequired"),{index:W,step:b,status:f}}),j=k.some(b=>b.status==="pending"),x=k.every(b=>b.status==="completed"),A=k.some(b=>b.status==="failed"),p=C.useCallback(async()=>{if(x){e.onDone();return}if(a===0){const b=ts(e.quote.onRampLink,e.theme);q({event:"open_onramp_popup",client:e.client,walletAddress:e.payer.account.address,walletType:e.payer.wallet.id,toChainId:e.quote.onRampToken.token.chainId,toToken:e.quote.onRampToken.token.tokenAddress,amountWei:e.quote.onRampToken.amountWei}),i(b),Xt({type:"fiat",intentId:e.quote.intentId})}else if(c&&h&&!r)try{const b=await m.mutateAsync({fromToken:c.token,toToken:h.token,amount:h.amount});u({hash:b.transactionHash,chainId:b.chainId})}catch(b){console.error("Failed to execute swap:",b)}else A&&(u(void 0),m.reset())},[x,a,r,e.quote,e.onDone,m,e.theme,A,m.reset,e.client,e.payer.account.address,e.payer.wallet.id,h,c]);return C.useEffect(()=>{e.isAutoMode&&!j&&!x&&!A&&a>0&&a<n.length&&!r&&p()},[e.isAutoMode,a,r,n.length,p,x,A,j]),{steps:k,handleContinue:p,isLoading:j,isDone:x,isFailed:A}}function os(e){var d;const n=ve(),a=en({intentId:e.intentId,client:e.client,queryOptions:{enabled:!!e.openedWindow}});let s="actionRequired";switch((d=a.data)==null?void 0:d.status){case"ON_RAMP_TRANSFER_COMPLETED":case"CRYPTO_SWAP_COMPLETED":case"CRYPTO_SWAP_REQUIRED":s="completed";break;case"CRYPTO_SWAP_FALLBACK":s="partialSuccess";break;case"ON_RAMP_TRANSFER_FAILED":case"PAYMENT_FAILED":s="failed";break;case"PENDING_PAYMENT":case"ON_RAMP_TRANSFER_IN_PROGRESS":s="pending";break;default:s="actionRequired";break}const r=C.useRef(!1);C.useEffect(()=>{r.current||!e.onSuccess||a.data&&(s==="completed"||s==="partialSuccess")&&(r.current=!0,e.onSuccess(a.data))},[e.onSuccess,a.data,s]),C.useEffect(()=>{if(e.openedWindow&&(s==="completed"||s==="partialSuccess"))try{e.openedWindow&&!e.openedWindow.closed&&e.openedWindow.close()}catch(i){console.warn("Failed to close payment window:",i)}},[e.openedWindow,s]);const u=C.useRef(!1);return C.useEffect(()=>{!u.current&&s==="completed"&&(u.current=!0,we(n))},[s,n]),{uiStatus:s}}function is(e){var d;const n=sn(e.transactionHash&&e.chainId?{client:e.client,transactionHash:e.transactionHash,chainId:e.chainId}:void 0);let a="unknown";switch((d=n.data)==null?void 0:d.status){case"COMPLETED":a="completed";break;case"FAILED":a="failed";break;case"PENDING":case"NOT_FOUND":a="pending";break;case"NONE":a="unknown";break;default:a="unknown";break}const s=C.useRef(!1);C.useEffect(()=>{var i;s.current||!e.onSuccess||((i=n.data)==null?void 0:i.status)==="COMPLETED"&&(s.current=!0,e.onSuccess(n.data))},[e.onSuccess,n]);const r=ve(),u=C.useRef(!1);return C.useEffect(()=>{a==="completed"&&!u.current&&(u.current=!0,we(r))},[r,a]),{uiStatus:a}}function rs(e){const n=ve();return tn({mutationFn:async a=>{var j;const{fromToken:s,toToken:r,amount:u}=a,d=e.payer.wallet;((j=d.getChain())==null?void 0:j.id)!==s.chainId&&await d.switchChain(V(s.chainId));const i=d.getAccount();if(!i)throw new Error("Payer wallet has no account");const o=await dt({fromChainId:s.chainId,fromTokenAddress:s.tokenAddress,toAmount:u,toChainId:r.chainId,toTokenAddress:r.tokenAddress,fromAddress:i.address,toAddress:i.address,client:e.client}),c=i.sendBatchTransaction,h=te({client:e.client,address:o.swapDetails.fromToken.tokenAddress,chain:V(o.swapDetails.fromToken.chainId)}),m=o.approvalData&&await Le({contract:h,owner:i.address,spender:o.approvalData.spenderAddress})<BigInt(o.approvalData.amountWei);if(m&&o.approvalData&&!c){q({event:"prompt_swap_approval",client:e.client,walletAddress:i.address,walletType:e.payer.wallet.id,fromToken:o.swapDetails.fromToken.tokenAddress,chainId:o.swapDetails.fromToken.chainId,amountWei:o.swapDetails.fromAmountWei,toToken:o.swapDetails.toToken.tokenAddress,toChainId:o.swapDetails.toToken.chainId});const x=Ee({contract:h,spender:o.approvalData.spenderAddress,amountWei:BigInt(o.approvalData.amountWei)}),A=await Ce({account:i,transaction:x});await Ie({...A,maxBlocksWaitTime:50}),q({event:"swap_approval_success",client:e.client,walletAddress:i.address,walletType:e.payer.wallet.id,fromToken:o.swapDetails.fromToken.tokenAddress,amountWei:o.swapDetails.fromAmountWei,toToken:o.swapDetails.toToken.tokenAddress,chainId:o.swapDetails.fromToken.chainId,toChainId:o.swapDetails.toToken.chainId})}q({event:"prompt_swap_execution",client:e.client,walletAddress:i.address,walletType:e.payer.wallet.id,fromToken:o.swapDetails.fromToken.tokenAddress,amountWei:o.swapDetails.fromAmountWei,toToken:o.swapDetails.toToken.tokenAddress,chainId:o.swapDetails.fromToken.chainId,toChainId:o.swapDetails.toToken.chainId});const y=o.transactionRequest;let k;if(c&&o.approvalData&&m){const x=Ee({contract:h,spender:o.approvalData.spenderAddress,amountWei:BigInt(o.approvalData.amountWei)});k=await nn({account:i,transactions:[x,y]})}else k=await Ce({account:i,transaction:y});return await Ie({...k,maxBlocksWaitTime:50}),q({event:"swap_execution_success",client:e.client,walletAddress:i.address,walletType:e.payer.wallet.id,fromToken:o.swapDetails.fromToken.tokenAddress,amountWei:o.swapDetails.fromAmountWei,toToken:o.swapDetails.toToken.tokenAddress,toChainId:o.swapDetails.toToken.chainId,chainId:o.swapDetails.fromToken.chainId}),{transactionHash:k.transactionHash,chainId:k.chain.id}},onSuccess:()=>{we(n)}})}function cs(e){const n=s=>Zt(s)||Jt(s),a=Yt(e.wallet)&&e.connectedWallets.some(s=>{var r,u,d,i,o,c;return n(s)&&((u=(r=s.getAccount())==null?void 0:r.address)==null?void 0:u.toLowerCase())===((c=(o=(i=(d=e.wallet).getAdminAccount)==null?void 0:i.call(d))==null?void 0:o.address)==null?void 0:c.toLowerCase())});return n(e.wallet)||a}function ds(e){const{payOptions:n,supportedDestinations:a,toChain:s,toToken:r}=e;function u(){const h=a.find(k=>k.chain.id===s.id);if(!h)return{fiat:!1,swap:!1};const m=D(r)?M:r.address,y=h.tokens.find(k=>k.address.toLowerCase()===m.toLowerCase());return y?{fiat:y.buyWithFiatEnabled,swap:y.buyWithCryptoEnabled}:{fiat:!0,swap:!0}}const{fiat:d,swap:i}=u(),o=n.buyWithFiat!==!1&&d,c=n.buyWithCrypto!==!1&&i;return{buyWithFiatEnabled:o,buyWithCryptoEnabled:c}}const ls=on({id:137,name:"Polygon",nativeCurrency:{name:"POL",symbol:"POL",decimals:18},blockExplorers:[{name:"PolygonScan",url:"https://polygonscan.com",apiUrl:"https://api.polygonscan.com/api"}]});function us(e){var k,j,x,A;const{payOptions:n,supportedDestinations:a}=e,s=n==null?void 0:n.prefillBuy,r=St(),u=(s==null?void 0:s.amount)||"",[d,i]=C.useState(u),o=At(d,300);C.useEffect(()=>{s!=null&&s.amount&&i(s.amount),s!=null&&s.chain&&h(s.chain),s!=null&&s.token&&y(s.token)},[s==null?void 0:s.amount,s==null?void 0:s.chain,s==null?void 0:s.token]);const[c,h]=C.useState((s==null?void 0:s.chain)||n.mode==="transaction"&&((k=n.transaction)==null?void 0:k.chain)||n.mode==="direct_payment"&&((j=n.paymentInfo)==null?void 0:j.chain)||((x=a.find(p=>p.chain.id===(r==null?void 0:r.id)))==null?void 0:x.chain)||((A=a[0])==null?void 0:A.chain)||ls),[m,y]=C.useState((s==null?void 0:s.token)||n.mode==="direct_payment"&&n.paymentInfo.token||mt);return{toChain:c,setToChain:h,toToken:m,setToToken:y,tokenAmount:d,setTokenAmount:i,deferredTokenAmount:o}}function hs(e){var h,m,y,k,j,x;const{payOptions:n}=e,[a,s]=C.useState(),r=n.buyWithCrypto!==!1&&((m=(h=n.buyWithCrypto)==null?void 0:h.prefillSource)==null?void 0:m.chain)||n.mode==="transaction"&&((y=n.transaction)==null?void 0:y.chain)||n.mode==="direct_payment"&&((k=n.paymentInfo)==null?void 0:k.chain),u=a||r||void 0,[d,i]=C.useState(),o=n.buyWithCrypto!==!1&&((x=(j=n.buyWithCrypto)==null?void 0:j.prefillSource)==null?void 0:x.token)||n.mode==="direct_payment"&&n.paymentInfo.token;return{fromChain:u,setFromChain:s,fromToken:d||o||void 0,setFromToken:i}}function ms(e){var d,i;const{payOptions:n}=e,s=(n.buyWithFiat!==!1?(i=(d=n.buyWithFiat)==null?void 0:d.prefillSource)==null?void 0:i.currency:void 0)||fs(),[r,u]=C.useState(yt.find(o=>o.shorthand===s)||rn);return{selectedCurrency:r,setSelectedCurrency:u}}function fs(){try{const e=Intl.DateTimeFormat().resolvedOptions().timeZone.toLowerCase();return e.includes("london")?"GBP":e.includes("europe")?"EUR":e.includes("japan")?"JPY":e.includes("canada")?"CAD":e.includes("australia")?"AUD":e.includes("new zealand")?"NZD":"USD"}catch{return"USD"}}function xs(e){return e.length>10?"26px":e.length>6?"34px":"50px"}function qe(e){var s;const n=At(e.tokenAmount,500),a=ae({queryKey:["cryptoToFiat",e.chain.id,at(e.token),n],queryFn:()=>cn({client:e.client,chain:e.chain,fromTokenAddress:at(e.token),fromAmount:Number(n),to:"USD"})});return a.isLoading?t.jsx(be,{width:"50px",height:re.lg}):(s=a.data)!=null&&s.result?t.jsxs(w,{...e,children:["$",H(a.data.result,2).toFixed(2)]}):null}function ys(e){const n=()=>{let a=e.value.replace(".","").length;return e.value.includes(".")&&(a+=.3),`calc(${`${Math.max(1,a)}ch`} + 6px)`};return t.jsxs(l,{children:[t.jsx("div",{onClick:a=>{var s;(s=a.currentTarget.querySelector("input"))==null||s.focus()},children:t.jsxs(l,{flex:"row",center:"both",gap:"xs",style:{flexWrap:"nowrap"},children:[t.jsx(pt,{variant:"outline",pattern:"^[0-9]*[.,]?[0-9]*$",inputMode:"decimal",tabIndex:-1,placeholder:"0",type:"text","data-placeholder":e.value==="",value:e.value||"0",disabled:e.freezeAmount,onClick:a=>{e.value===""&&a.currentTarget.setSelectionRange(a.currentTarget.value.length,a.currentTarget.value.length)},onChange:a=>{let s=a.target.value;s=s.replace(",","."),s.startsWith(".")&&(s=`0${s}`);const r=Number(s);Number.isNaN(r)||(s.startsWith("0")&&!s.startsWith("0.")?e.onChange(s.slice(1)):e.onChange(s))},style:{border:"none",fontSize:xs(e.value),boxShadow:"none",borderRadius:"0",padding:"0",paddingBlock:"2px",fontWeight:600,textAlign:"right",width:n(),maxWidth:"calc(100% - 100px)"}}),t.jsx(se,{token:e.token,chain:e.chain,size:"lg",color:"secondaryText"})]})}),t.jsx(l,{flex:"row",center:"both",style:{height:re.xl},children:t.jsx(qe,{tokenAmount:e.value,token:e.token,chain:e.chain,client:e.client,size:"md"})}),!e.hideTokenSelector&&t.jsxs(t.Fragment,{children:[t.jsx(g,{y:"md"}),t.jsx(l,{flex:"row",center:"x",children:t.jsx(vt,{token:e.token,chain:e.chain,client:e.client,onSelectToken:e.onSelectToken,freezeChainAndToken:e.freezeChainAndToken})})]})]})}function ks(e){var s;const n=Z(),a=Oe({address:e.payerAccount.address,chain:e.chain,tokenAddress:D(e.token)||(s=e.token)==null?void 0:s.address,client:e.client},{enabled:!!e.chain&&!!e.token});return t.jsxs(l,{bg:"tertiaryBg",style:{borderRadius:G.lg,border:`1px solid ${n.colors.borderColor}`,...e.swapRequired?{borderBottom:"none",borderBottomLeftRadius:0,borderBottomRightRadius:0}:{}},children:[t.jsxs(l,{flex:"row",gap:"sm",style:{justifyContent:"space-between",padding:E.sm,borderBottom:`1px solid ${n.colors.borderColor}`},children:[t.jsx(pe,{client:e.client,address:e.payerAccount.address}),e.token&&e.chain&&a.data?t.jsxs(l,{flex:"row",gap:"3xs",center:"y",children:[t.jsx(w,{size:"xs",color:"secondaryText",weight:500,children:Pe(a.data,!1,4)}),t.jsx(se,{token:e.token,chain:e.chain,size:"xs",color:"secondaryText"})]}):e.token&&e.chain&&a.isLoading?t.jsx(be,{width:"70px",height:re.xs}):null]}),t.jsx(vt,{token:e.token,chain:e.chain,client:e.client,isLoading:e.isLoading,value:e.value,onSelectToken:e.onSelectToken,style:{border:"none",borderRadius:0,borderBottomLeftRadius:!e.token||!e.chain||!e.swapRequired?G.lg:0,borderBottomRightRadius:!e.token||!e.chain||!e.swapRequired?G.lg:0}})]})}function ws(e){var ie,J,X,Q,ce,de,le,ue,he,me;const{setScreen:n,payer:a,client:s,toChain:r,tokenAmount:u,toToken:d,fromChain:i,fromToken:o,payOptions:c,disableTokenSelection:h}=e,y=((J=(ie=e.payOptions)==null?void 0:ie.paymentInfo)==null?void 0:J.sellerAddress)||e.activeAccount.address,{drawerRef:k,drawerOverlayRef:j,isOpen:x,setIsOpen:A}=Rt(),[p,b]=C.useState("fees"),W=Oe({address:a.account.address,chain:i,tokenAddress:D(o)||o==null?void 0:o.address,client:s},{enabled:!!i&&!!o}),f=D(o)?M:(X=o==null?void 0:o.address)==null?void 0:X.toLowerCase(),v=D(d)?M:d.address.toLowerCase(),S=!!u&&!!i&&!!f&&!((i==null?void 0:i.id)===r.id&&f===v),I=i&&o&&S?{fromAddress:a.account.address,toAddress:y,fromChainId:i.id,fromTokenAddress:D(o)?M:o.address,toChainId:r.id,toTokenAddress:D(d)?M:d.address,toAmount:u,client:s,purchaseData:c.purchaseData}:void 0,T=Fn(I,{staleTime:30*1e3,refetchInterval:30*1e3,gcTime:30*1e3}),R=ae({queryKey:["allowance",a.account.address,(Q=T.data)==null?void 0:Q.approvalData],queryFn:()=>{var ee;return(ee=T.data)!=null&&ee.approvalData?Le({contract:te({client:e.client,address:T.data.swapDetails.fromToken.tokenAddress,chain:V(T.data.swapDetails.fromToken.chainId)}),spender:T.data.approvalData.spenderAddress,owner:e.payer.account.address}):null},enabled:!!((ce=T.data)!=null&&ce.approvalData),refetchOnMount:!0}),N=S?(de=T.data)==null?void 0:de.swapDetails.fromAmount:u,B=!!N&&!!W.data&&Number(W.data.displayValue)<Number(N),K=!i||!o||S&&!T.data||B||R.isLoading,U=((le=e.payer.wallet.getChain())==null?void 0:le.id)!==(i==null?void 0:i.id),O=!T.isLoading&&T.error?Wt(T.error):void 0;function $(){if((e.payOptions.mode==="direct_payment"||e.payOptions.mode==="fund_wallet")&&!B&&!S)n({id:"transfer-flow"});else if(e.payOptions.mode==="transaction"&&!B&&!S){a.account.address!==y?n({id:"transfer-flow"}):e.onDone();return}T.data&&n({id:"swap-flow",quote:T.data,approvalAmount:R.data??void 0})}function oe(){T.data&&(A(!0),b("fees"))}return t.jsxs(l,{flex:"column",gap:"lg",animate:"fadein",children:[x&&t.jsxs(t.Fragment,{children:[t.jsx(Et,{ref:j}),t.jsx(Dt,{ref:k,close:()=>A(!1),children:p==="fees"&&T.data&&t.jsxs("div",{children:[t.jsx(w,{size:"lg",color:"primaryText",children:"Fees"}),t.jsx(g,{y:"lg"}),t.jsx(Gn,{quote:T.data})]})})]}),t.jsxs(l,{flex:"column",gap:"sm",children:[t.jsxs(l,{flex:"row",gap:"xxs",center:"y",children:[t.jsx(w,{size:"sm",children:"Pay with"}),o&&i?t.jsx(se,{token:o,chain:i,size:"sm",color:"secondaryText"}):"crypto"]}),t.jsxs("div",{children:[t.jsx(ks,{value:N||"",chain:i,token:o,isLoading:T.isLoading&&!N,client:s,freezeChainAndTokenSelection:h,payerAccount:e.payer.account,swapRequired:S,onSelectToken:e.showFromTokenSelector}),S&&i&&o&&t.jsx(Bt,{quoteIsLoading:T.isLoading,estimatedSeconds:(ue=T.data)==null?void 0:ue.swapDetails.estimated.durationSeconds,onViewFees:oe})]}),O&&t.jsx("div",{children:(he=O.data)!=null&&he.minimumAmountEth?t.jsxs(w,{color:"danger",size:"xs",center:!0,multiline:!0,children:["Minimum amount is"," ",H(Number(O.data.minimumAmountEth),6)," ",t.jsx(se,{token:d,chain:r,size:"sm",inline:!0,color:"danger"})]}):t.jsxs("div",{children:[t.jsx(w,{color:"danger",size:"xs",center:!0,multiline:!0,children:O.title}),t.jsx(w,{size:"xs",center:!0,multiline:!0,children:O.message})]})}),!O&&B&&t.jsxs("div",{children:[t.jsx(w,{color:"danger",size:"xs",center:!0,multiline:!0,children:"Insufficient Funds"}),t.jsx(w,{size:"xs",center:!0,multiline:!0,children:"Select another token or pay with card."})]})]}),(me=O==null?void 0:O.data)!=null&&me.minimumAmountEth?t.jsx(L,{variant:"accent",fullWidth:!0,onClick:()=>{var ee;e.setTokenAmount(H(Number((ee=O.data)==null?void 0:ee.minimumAmountEth),6).toString()),e.setHasEditedAmount(!0)},children:"Set Minimum"}):B||O?t.jsx(L,{variant:"accent",fullWidth:!0,onClick:()=>e.showFromTokenSelector(),children:"Pay with another token"}):U&&i&&!T.isLoading&&!R.isLoading&&!B&&!T.error?t.jsx(ze,{variant:"accent",fullWidth:!0,switchChain:async()=>{await e.payer.wallet.switchChain(i)}}):t.jsx(L,{variant:K?"outline":"accent",fullWidth:!0,"data-disabled":K,disabled:K,onClick:async()=>{K||($(),q({event:"confirm_swap_quote",client:s,walletAddress:a.account.address,walletType:a.wallet.id,chainId:i.id,fromToken:D(o)?void 0:o.address,toChainId:r.id,toToken:D(d)?void 0:d.address}))},gap:"xs",children:T.isLoading?t.jsxs(t.Fragment,{children:["Getting price quote",t.jsx(ke,{size:"sm",color:"accentText"})]}):"Continue"})]})}const rt=5;function gs(e){const n=[];for(let a=0;a<e.length;a+=rt)n.push(e.slice(a,a+rt));return n}async function js({wallet:e,accountAddress:n,sourceSupportedTokens:a,toChain:s,toToken:r,tokenAmount:u,mode:d,client:i}){var p,b,W;const o=e.getAccount();if(!o)return[];const c=[],h=Object.keys(a).map(f=>V(Number(f))),y=(await Promise.all(h.map(async f=>({chain:f,enabled:await Bn(f)})))).filter(f=>f.enabled).map(f=>f.chain),k=gs(y);await Promise.all(k.map(async f=>{var S;const v=await dn({ownerAddress:o.address,chains:f,client:i});for(const I of v){const T=(S=a[I.chainId])==null?void 0:S.find(R=>R.address.toLowerCase()===I.tokenAddress.toLowerCase());T&&c.push({balance:I,chain:V(I.chainId),token:T})}}));const j=D(r)?{address:M,name:((p=s.nativeCurrency)==null?void 0:p.name)||"",symbol:((b=s.nativeCurrency)==null?void 0:b.symbol)||"",icon:(W=s.icon)==null?void 0:W.url}:r,x={...a,[s.id]:[j,...a[s.id]||[]]},A=[];for(const[f,v]of Object.entries(x)){const S=Number(f),I=V(S);for(const T of v){const R=D(T),N=c.some(B=>B.chain.id===S&&B.token.address.toLowerCase()===T.address.toLowerCase());!R&&!N||A.push((async()=>{try{const B=await De({address:o.address,chain:I,tokenAddress:R?void 0:T.address,client:i});(T.address===j.address&&I.id===s.id?d==="fund_wallet"&&o.address===n?!1:Number(B.displayValue)>Number(u):B.value>0n)&&c.push({balance:B,chain:I,token:T})}catch(B){console.warn(`Failed to fetch balance for ${T.symbol} on chain ${S}`,B)}})())}}await Promise.all(A);{const f={};for(const v of c){const S=`${v.chain.id}-${v.token.address.toLowerCase()}`;f[S]||(f[S]=v)}c.splice(0,c.length,...Object.values(f))}return c.sort((f,v)=>{const S=j.address;return f.chain.id===s.id&&f.token.address===S?-1:v.chain.id===s.id&&v.token.address===S?1:f.chain.id===s.id?-1:v.chain.id===s.id?1:f.chain.id-v.chain.id}),c}function bs(e){var o;const n=bt(),a=je(),s=Ae(),r=Re(e.toChain),u=Z(),d=ae({queryKey:["wallets-and-balances",e.sourceSupportedTokens,e.toChain.id,e.toToken,e.tokenAmount,e.mode,a==null?void 0:a.address,n.map(c=>{var h;return(h=c.getAccount())==null?void 0:h.address})],enabled:!!e.sourceSupportedTokens&&!!r.data,queryFn:async()=>{const c=await Promise.all(n.map(async m=>{var k;const y=await js({wallet:m,accountAddress:a==null?void 0:a.address,sourceSupportedTokens:e.sourceSupportedTokens||[],toChain:e.toChain,toToken:e.toToken,tokenAmount:e.tokenAmount,mode:e.mode,client:e.client});return[{id:m.id,address:((k=m.getAccount())==null?void 0:k.address)||""},y]})),h=new Map;for(const m of c)h.set(m[0],m[1]);return h}});if(d.isLoading||r.isLoading||!r.data||!e.sourceSupportedTokens)return t.jsx(ye,{});const i=Array.from(((o=d.data)==null?void 0:o.entries())||[]).filter(([c])=>{var h;return!((h=e.hiddenWallets)!=null&&h.includes(c.id))}).filter(([,c])=>c.some(m=>m.balance.value>0));return t.jsxs(l,{animate:"fadein",style:{minHeight:"200px"},children:[i.length===0?t.jsx(l,{flex:"column",gap:"xs",py:"lg",children:t.jsxs(w,{size:"xs",color:"secondaryText",center:!0,children:["No suitable payment token found",t.jsx("br",{}),"in connected wallets"]})}):t.jsxs(l,{flex:"column",gap:"xs",children:[t.jsx(w,{size:"sm",children:"Select payment token"}),t.jsx(g,{y:"xs"})]}),t.jsx(l,{scrollY:!0,style:{maxHeight:"350px"},children:t.jsxs(l,{flex:"column",gap:"sm",children:[i.map(([c,h])=>{const m=c.address,y=n.find(k=>{var j;return((j=k.getAccount())==null?void 0:j.address)===m});return y?t.jsx(Ts,{wallet:y,balances:h,client:e.client,address:m,onClick:(k,j,x)=>{q({event:"choose_payment_method_token",client:e.client,walletAddress:a==null?void 0:a.address,walletType:s==null?void 0:s.id,chainId:x.id,fromToken:D(j)?void 0:j.address,toToken:D(e.toToken)?void 0:e.toToken.address,toChainId:e.toChain.id}),e.onSelectToken(k,j,x)}},c.id):null}),i.length>0&&t.jsx(ln,{text:"OR"}),t.jsx(L,{variant:"secondary",fullWidth:!0,onClick:()=>{q({event:"choose_payment_method_another_wallet",client:e.client,walletAddress:a==null?void 0:a.address,walletType:s==null?void 0:s.id,toChainId:e.toChain.id,toToken:D(e.toToken)?void 0:e.toToken.address}),e.onConnect()},bg:"tertiaryBg",style:{border:`1px solid ${u.colors.borderColor}`,padding:E.sm},children:t.jsxs(l,{flex:"row",gap:"sm",center:"y",expand:!0,color:"secondaryIconColor",children:[t.jsx(ft,{size:P.md}),t.jsx(w,{size:"sm",color:"primaryText",children:"Pay with another wallet"})]})}),e.fiatSupported&&t.jsx(L,{variant:"secondary",fullWidth:!0,onClick:()=>{q({event:"choose_payment_method_with_card",client:e.client,walletAddress:a==null?void 0:a.address,walletType:s==null?void 0:s.id,toChainId:e.toChain.id,toToken:D(e.toToken)?void 0:e.toToken.address}),e.onPayWithFiat()},bg:"tertiaryBg",style:{border:`1px solid ${u.colors.borderColor}`,padding:E.sm},children:t.jsxs(l,{flex:"row",gap:"sm",center:"y",expand:!0,color:"secondaryIconColor",children:[t.jsx(un,{width:P.md,height:P.md}),t.jsx(w,{size:"sm",color:"primaryText",children:"Pay with card"})]})})]})})]})}function Ts(e){const n=Z(),a=e.balances,s=je(),{disconnect:r}=hn(),u=(s==null?void 0:s.address)===e.address;return t.jsxs(l,{flex:"column",style:{borderRadius:G.lg,border:`1px solid ${n.colors.borderColor}`},children:[t.jsxs(l,{flex:"row",gap:"sm",bg:"tertiaryBg",style:{justifyContent:"space-between",borderTopRightRadius:G.lg,borderTopLeftRadius:G.lg,padding:E.sm,paddingRight:E.xs,borderBottom:`1px solid ${n.colors.borderColor}`},children:[t.jsx(pe,{...e}),!u&&t.jsx(L,{variant:"ghost",onClick:()=>r(e.wallet),style:{padding:E.xxs,color:n.colors.secondaryText},children:t.jsx(gt,{width:P.sm,height:P.sm})})]}),t.jsx(l,{flex:"column",children:e.balances.length>0?a.map((d,i)=>t.jsx(Cs,{client:e.client,onClick:()=>e.onClick(e.wallet,d.token,d.chain),tokenBalance:d,wallet:e.wallet,style:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomRightRadius:i===a.length-1?G.lg:0,borderBottomLeftRadius:i===a.length-1?G.lg:0,borderBottom:i===a.length-1?"none":`1px solid ${n.colors.borderColor}`}},`${d.token.address}-${d.chain.id}`)):t.jsx(l,{style:{padding:E.sm},children:t.jsx(w,{size:"sm",color:"secondaryText",children:"Insufficient Funds"})})})]})}function Cs(e){const{tokenBalance:n,wallet:a,onClick:s,client:r,style:u}=e,d=Tt(n.chain);return t.jsxs(Ss,{onClick:()=>s(n.token,a),variant:"secondary",style:{...u,display:"flex",justifyContent:"space-between",minWidth:0},children:[t.jsxs(l,{flex:"row",center:"y",gap:"sm",style:{flex:"1 1 50%",minWidth:0,maxWidth:"50%",overflow:"hidden",flexWrap:"nowrap"},children:[t.jsx(Be,{token:n.token,chain:n.chain,size:"md",client:r}),t.jsxs(l,{flex:"column",gap:"4xs",style:{minWidth:0},children:[t.jsx(w,{size:"xs",color:"primaryText",style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n.token.symbol}),d&&t.jsx(w,{size:"xs",style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:d.name})]})]}),t.jsxs(l,{flex:"row",center:"y",gap:"4xs",color:"secondaryText",style:{flex:"1 1 50%",maxWidth:"50%",minWidth:0,justifyContent:"flex-end",flexWrap:"nowrap"},children:[t.jsxs(l,{flex:"column",color:"secondaryText",gap:"4xs",style:{alignItems:"flex-end",minWidth:0,overflow:"hidden"},children:[t.jsx(w,{size:"xs",color:"primaryText",style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:Pe(n.balance,!0,2)}),t.jsx(qe,{tokenAmount:n.balance.displayValue,token:n.token,chain:n.chain,client:r,size:"xs"})]}),t.jsx(mn,{width:P.md,height:P.md,style:{flexShrink:0}})]})]})}const Ss=_e(L)(e=>{const n=Z();return{background:"transparent",justifyContent:"space-between",flexWrap:"nowrap",flexDirection:"row",padding:E.sm,paddingRight:E.xs,gap:E.sm,"&:hover":{background:n.colors.secondaryButtonBg,transform:"scale(1.01)"},transition:"background 200ms ease, transform 150ms ease",...e.style}});async function As(e){try{const a=await lt(e.client)(fn(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:ut({fromAddress:e.fromAddress,toAddress:e.toAddress,chainId:e.chainId,tokenAddress:e.tokenAddress,amount:e.amount,purchaseData:e.purchaseData,feePayer:e.feePayer})});if(!a.ok){const u=await a.json();throw u&&"error"in u?u:new Error(`HTTP error! status: ${a.status}`)}const s=(await a.json()).result;return{transactionRequest:{chain:V(s.transactionRequest.chainId),client:e.client,data:s.transactionRequest.data,to:s.transactionRequest.to,value:BigInt(s.transactionRequest.value),extraGas:50000n},approvalData:s.approval,fromAddress:s.fromAddress,toAddress:s.toAddress,paymentToken:s.paymentToken,processingFee:s.processingFee,estimatedGasCostUSDCents:s.estimatedGasCostUSDCents,client:e.client}}catch(n){throw console.error("Error getting buy with crypto transfer",n),n}}function ps(e){var f;const{title:n,onBack:a,receiverAddress:s,client:r,payer:u,onDone:d,chain:i,token:o,tokenAmount:c,transactionMode:h,setTransactionHash:m,payOptions:y}=e,[k,j]=C.useState("transfer"),[x,A]=C.useState({id:"idle"}),p=ae({queryKey:["transfer",D(o)?M:o.address,c,s,u.account.address,y==null?void 0:y.purchaseData],queryFn:async()=>await As({client:r,fromAddress:u.account.address,toAddress:s,chainId:i.id,tokenAddress:D(o)?M:o.address,amount:c,purchaseData:y==null?void 0:y.purchaseData,feePayer:(y==null?void 0:y.mode)==="direct_payment"?y.paymentInfo.feePayer:void 0}),refetchInterval:30*1e3}),b=C.useMemo(()=>{if(k==="approve"&&x.id==="error"&&x.error)return x.error.toLowerCase().includes("user rejected")||x.error.toLowerCase().includes("user closed modal")||x.error.toLowerCase().includes("user denied")?{title:"Failed to Approve",message:"Your wallet rejected the approval request."}:{title:"Failed to Approve",message:"Your wallet failed to approve the transaction for an unknown reason. Please try again or contact support."};if((k==="transfer"||k==="execute")&&x.id==="error"&&x.error)return x.error.toLowerCase().includes("user rejected")?{title:"Failed to Confirm",message:"Your wallet rejected the confirmation request."}:{title:"Failed to Confirm",message:"Your wallet failed to confirm the transaction for an unknown reason. Please try again or contact support."}},[k,x]);if(p.isLoading)return t.jsxs(l,{p:"lg",children:[t.jsx(ne,{title:n,onBack:a}),t.jsxs(l,{flex:"column",center:"both",style:{minHeight:"300px"},children:[t.jsx(g,{y:"xl"}),t.jsx(ke,{size:"xl",color:"secondaryText"}),t.jsx(g,{y:"xl"})]})]});const W=((f=p.data)==null?void 0:f.paymentToken.amount)||c;return t.jsxs(l,{p:"lg",children:[t.jsx(ne,{title:n,onBack:a}),t.jsx(g,{y:"xl"}),h?t.jsxs(t.Fragment,{children:[t.jsx(xn,{steps:2,currentStep:k==="transfer"?1:2}),t.jsx(g,{y:"sm"}),t.jsx(w,{size:"sm",children:k==="transfer"?"Step 1 of 2 - Transfer funds":"Step 2 of 2 - Finalize transaction"}),t.jsx(g,{y:"md"})]}):t.jsxs(t.Fragment,{children:[t.jsx(w,{size:"sm",children:"Confirm payment"}),t.jsx(g,{y:"md"})]}),t.jsx(yn,{sender:u.account.address,receiver:s,client:r,fromToken:o,fromChain:i,toToken:o,toChain:i,fromAmount:h?c:W,toAmount:c}),t.jsx(g,{y:"lg"}),h&&t.jsxs(t.Fragment,{children:[t.jsx(g,{y:"sm"}),t.jsxs(l,{gap:"sm",flex:"row",style:{justifyContent:"space-between"},center:"y",color:"accentText",children:[t.jsx(ot,{isDone:k==="execute",isActive:k==="transfer",label:k==="transfer"?"Transfer":"Done"}),t.jsx(kn,{}),t.jsx(ot,{isDone:!1,label:"Finalize",isActive:k==="execute"})]}),t.jsx(g,{y:"lg"})]}),b&&t.jsxs(t.Fragment,{children:[t.jsx(wn,{title:b.title,message:b.message}),t.jsx(g,{y:"md"})]}),!h&&k==="execute"&&x.id==="done"&&t.jsxs(t.Fragment,{children:[t.jsxs(l,{flex:"row",gap:"xs",center:"both",color:"success",children:[t.jsx(gn,{width:P.sm,height:P.sm}),t.jsx(w,{color:"success",size:"sm",children:"Payment completed"})]}),t.jsx(g,{y:"md"})]}),u.chain.id!==i.id?t.jsx(ze,{fullWidth:!0,variant:"accent",switchChain:async()=>{await e.payer.wallet.switchChain(i)}}):t.jsxs(L,{variant:"accent",fullWidth:!0,disabled:x.id==="pending",onClick:async()=>{var v,S;if(k==="execute"){d();return}try{if(A({id:"pending"}),h){const I=D(o)?jn({client:r,chain:i,to:s,value:xe(c)}):bn({contract:te({address:o.address,chain:i,client:r}),to:s,amount:c}),[T,R]=await Promise.all([it({account:e.payer.account,transaction:I}),It({contract:te({address:D(o)?M:o.address,chain:i,client:r})})]);q({client:e.client,walletAddress:u.account.address,walletType:u.wallet.id,toChainId:i.id,toToken:D(o)?void 0:o.address,event:"transfer_confirmation_success_transaction_mode"}),(v=e.onSuccess)==null||v.call(e,vs({token:o,chain:i,tokenMetadata:R,tokenAmount:h?c:W,fromAddress:u.account.address,toAddress:s,transaction:T})),j("execute"),A({id:"idle"})}else{const I=p.data;if(!I)throw new Error("Transfer data not found");if(I.approvalData&&await Le({contract:te({client:r,address:I.approvalData.tokenAddress,chain:V(I.approvalData.chainId)}),spender:I.approvalData.spenderAddress,owner:u.account.address})<BigInt(I.approvalData.amountWei)){j("approve"),q({client:e.client,walletAddress:u.account.address,walletType:u.wallet.id,toChainId:i.id,toToken:D(o)?void 0:o.address,event:"prompt_transfer_approval"});const B=Ee({contract:te({client:r,address:I.approvalData.tokenAddress,chain:V(I.approvalData.chainId)}),spender:I.approvalData.spenderAddress,amountWei:BigInt(I.approvalData.amountWei)});await it({account:e.payer.account,transaction:B}),q({client:e.client,walletAddress:u.account.address,walletType:u.wallet.id,toChainId:i.id,toToken:D(o)?void 0:o.address,event:"transfer_approval_success"})}q({client:e.client,walletAddress:u.account.address,walletType:u.wallet.id,toChainId:i.id,toToken:D(o)?void 0:o.address,event:"prompt_transfer_confirmation"}),j("transfer");const T=I.transactionRequest,R=await Ce({account:e.payer.account,transaction:T});m(R.transactionHash),A({id:"idle"}),q({client:e.client,walletAddress:u.account.address,walletType:u.wallet.id,toChainId:i.id,toToken:D(o)?void 0:o.address,event:"transfer_confirmation_success"})}}catch(I){console.error(I),A({id:"error",error:"error"in I?(S=I.error)==null?void 0:S.message:I==null?void 0:I.message})}},gap:"xs",children:[k==="execute"&&(x.id==="done"?"Done":"Continue"),k==="transfer"&&(x.id==="pending"?"Confirming":"Confirm"),k==="approve"&&(x.id==="pending"?"Approving":"Approve"),x.id==="pending"&&t.jsx(ke,{size:"sm",color:"accentButtonText"})]})]})}function vs(e){const{token:n,chain:a,tokenMetadata:s,tokenAmount:r,fromAddress:u,toAddress:d,transaction:i}=e;return{status:"COMPLETED",subStatus:"SUCCESS",swapType:"TRANSFER",quote:{createdAt:new Date().toISOString(),fromToken:{chainId:a.id,tokenAddress:D(n)?M:n.address,decimals:s.decimals,symbol:s.symbol,name:s.name,priceUSDCents:0},toToken:{chainId:a.id,tokenAddress:D(n)?M:n.address,decimals:s.decimals,symbol:s.symbol,name:s.name,priceUSDCents:0},fromAmountWei:xe(r).toString(),fromAmount:r,toAmountWei:xe(r).toString(),toAmount:r,toAmountMin:r,toAmountMinWei:xe(r).toString(),estimated:{feesUSDCents:0,gasCostUSDCents:0,slippageBPS:0,toAmountMinUSDCents:0,toAmountUSDCents:0,fromAmountUSDCents:0,durationSeconds:0}},fromAddress:u,toAddress:d,source:{transactionHash:i.transactionHash,amount:r,amountWei:xe(r).toString(),amountUSDCents:0,completedAt:new Date().toISOString(),token:{chainId:a.id,tokenAddress:D(n)?M:n.address,decimals:s.decimals,symbol:s.symbol,name:s.name,priceUSDCents:0}}}}function Is(e){const[n,a]=C.useState();return n?t.jsx(Tn,{title:e.title,onBack:e.onBack,onTryAgain:e.onTryAgain,swapTxHash:n,fromChain:e.chain,client:e.client,onDone:e.onDone,transactionMode:!1,isEmbed:e.isEmbed,quote:void 0,onSuccess:e.onSuccess}):t.jsx(ps,{...e,setTransactionHash:a})}function Ws(){const e=Ae(),n=je(),a=St(),[s,r]=C.useState();return C.useEffect(()=>{const i=s==null?void 0:s.wallet;function o(){if(!i){r(void 0);return}const c=i.getAccount(),h=i.getChain();r(c&&h?{account:c,chain:h,wallet:i}:void 0)}if(i){const c=i.subscribe("chainChanged",o),h=i.subscribe("accountChanged",o);return()=>{c(),h()}}},[s]),{payer:s||(n&&a&&e?{account:n,chain:a,wallet:e}:void 0),setPayer:r}}function qs(e){const n=e.payOptions.buyWithCrypto?e.payOptions.buyWithCrypto.testMode:void 0,a=Cn(e.client,n);if(a.isError)return t.jsx(l,{style:{minHeight:"350px"},fullHeight:!0,flex:"row",center:"both",children:t.jsx(xt,{title:"Something went wrong",onTryAgain:a.refetch})});if(!a.data)return t.jsx(ye,{});const s=e.supportedTokens?Object.entries(e.supportedTokens).map(([r,u])=>({chain:V(Number.parseInt(r)),tokens:u.map(d=>({...d,buyWithCryptoEnabled:!0,buyWithFiatEnabled:!0}))})):a.data;return t.jsx(Ds,{...e,supportedDestinations:s})}function Ds(e){var J,X,Q,ce,de,le,ue,he,me,ee,Me,Ne,$e,He,Ue,Ve,Ke,Ge,Qe,Ye,Ze,Je,Xe,et;const{client:n,supportedDestinations:a,connectLocale:s,payOptions:r}=e,u=je(),{payer:d,setPayer:i}=Ws(),[o,c]=C.useState({id:"main"}),{tokenAmount:h,setTokenAmount:m,toChain:y,setToChain:k,deferredTokenAmount:j,toToken:x,setToToken:A}=us({payOptions:r,supportedDestinations:a}),[p,b]=C.useState(!1),W=C.useCallback(()=>{c({id:"main"}),e.onDone()},[e.onDone]),f=Sn({client:e.client,destinationChainId:y.id,destinationTokenAddress:D(x)?M:x.address}),v=C.useMemo(()=>ct(a,r,e.supportedTokens),[e.supportedTokens,a,r]),S=C.useMemo(()=>{if(!f.data)return;const F=f.data;return ct(F,r,e.supportedTokens)},[e.supportedTokens,f.data,r]),{fromChain:I,setFromChain:T,fromToken:R,setFromToken:N}=hs({payOptions:r,supportedSources:f.data||[]}),{selectedCurrency:B,setSelectedCurrency:K}=ms({payOptions:r}),U=ds({payOptions:e.payOptions,supportedDestinations:e.supportedDestinations,toChain:y,toToken:x}),O=U.buyWithCryptoEnabled===!1&&U.buyWithFiatEnabled===!1,$=ve(),oe=C.useCallback(F=>{var z,_;(_=(z=e.payOptions).onPurchaseSuccess)==null||_.call(z,{type:"crypto",status:F}),we($)},[e.payOptions.onPurchaseSuccess,$]),ie=C.useCallback(F=>{var z,_;(_=(z=e.payOptions).onPurchaseSuccess)==null||_.call(z,{type:"fiat",status:F}),we($)},[e.payOptions.onPurchaseSuccess,$]);if(o.id==="connect-payer-wallet")return t.jsx(An,{accountAbstraction:(J=e.connectOptions)==null?void 0:J.accountAbstraction,appMetadata:(X=e.connectOptions)==null?void 0:X.appMetadata,chain:y||((Q=e.connectOptions)==null?void 0:Q.chain),chains:[y,...((ce=e.connectOptions)==null?void 0:ce.chains)||[]],client:e.client,connectLocale:e.connectLocale,isEmbed:e.isEmbed,onBack:()=>c(o.backScreen),onSelect:F=>{const z=F.getAccount(),_=F.getChain();F&&z&&_&&i({account:z,chain:_,wallet:F})},hiddenWallets:e.hiddenWallets,recommendedWallets:(de=e.connectOptions)==null?void 0:de.recommendedWallets,showAllWallets:((le=e.connectOptions)==null?void 0:le.showAllWallets)===void 0?!0:(ue=e.connectOptions)==null?void 0:ue.showAllWallets,walletConnect:(he=e.connectOptions)==null?void 0:he.walletConnect,wallets:(ee=(me=e.connectOptions)==null?void 0:me.wallets)==null?void 0:ee.filter(F=>F.id!=="inApp")});if(o.id==="swap-flow"&&d)return t.jsx(pn,{title:e.title,transactionMode:r.mode==="transaction",isEmbed:e.isEmbed,client:n,onBack:()=>{c({id:"buy-with-crypto"})},buyWithCryptoQuote:o.quote,payer:d,isFiatFlow:!1,onDone:W,onTryAgain:()=>{c({id:"buy-with-crypto"})},onSuccess:oe,approvalAmount:o.approvalAmount});if(o.id==="fiat-flow"&&d){const z=((Ne=(Me=e.payOptions)==null?void 0:Me.paymentInfo)==null?void 0:Ne.sellerAddress)||d.account.address;return t.jsx(ns,{title:e.title,transactionMode:r.mode==="transaction",quote:o.quote,onBack:()=>{c({id:"buy-with-fiat"})},client:n,testMode:e.payOptions.buyWithFiat!==!1&&(($e=e.payOptions.buyWithFiat)==null?void 0:$e.testMode)===!0,theme:typeof e.theme=="string"?e.theme:e.theme.type,onDone:W,isEmbed:e.isEmbed,payer:d,receiverAddress:z,onSuccess:ie})}if(o.id==="transfer-flow"&&d&&u){const F=()=>c({id:"buy-with-crypto"}),_=((Ue=(He=e.payOptions)==null?void 0:He.paymentInfo)==null?void 0:Ue.sellerAddress)||u.address;return t.jsx(Is,{title:e.title,onBack:F,payer:d,client:e.client,chain:y,token:x,tokenAmount:h,receiverAddress:_,transactionMode:e.payOptions.mode==="transaction",payOptions:r,isEmbed:e.isEmbed,onDone:W,onTryAgain:()=>{c({id:"buy-with-crypto"})},onSuccess:oe})}if(o.id==="select-currency"){const F=()=>c(o.backScreen);return t.jsx(qn,{onSelect:z=>{F(),K(z)},onBack:F})}if(o.id==="select-to-token"){const F=a.map(Y=>Y.chain),z=()=>c(o.backScreen),_=(Ve=r==null?void 0:r.prefillBuy)==null?void 0:Ve.allowEdits;return(_==null?void 0:_.token)===!1?t.jsx(Fs,{chains:F,client:e.client,connectLocale:e.connectLocale,setChain:k,goBack:z}):t.jsx(vn,{onBack:z,tokenList:((y!=null&&y.id?v[y.id]:void 0)||[]).filter(Y=>Y.address!==M),onTokenSelect:Y=>{A(Y),z()},chain:y,chainSelection:(_==null?void 0:_.chain)!==!1?{chains:F,select:Y=>{k(Y)}}:void 0,connectLocale:s,client:n,modalTitle:e.title})}return t.jsx(l,{animate:"fadein",children:t.jsxs("div",{children:[o.id==="main"&&t.jsx(Rs,{title:e.title,payerAccount:d==null?void 0:d.account,client:n,onSelectBuyToken:()=>c({id:"select-to-token",backScreen:o}),payOptions:r,setTokenAmount:m,setToChain:k,setToToken:A,setFromChain:T,setFromToken:N,toChain:y,toToken:x,tokenAmount:h,connectOptions:e.connectOptions,setScreen:c,supportedDestinations:a,onBack:e.onBack,theme:e.theme,hasEditedAmount:p,setHasEditedAmount:b,enabledPaymentMethods:U}),(o.id==="select-payment-method"||o.id==="buy-with-crypto"||o.id==="buy-with-fiat"||o.id==="select-from-token")&&d&&t.jsxs(Bs,{disabled:"prefillBuy"in r&&((Ge=(Ke=r.prefillBuy)==null?void 0:Ke.allowEdits)==null?void 0:Ge.amount)===!1||r.mode!=="fund_wallet",title:e.title,selectedChain:y,selectedToken:x,tokenAmount:h,setTokenAmount:m,client:n,onBack:()=>{o.id==="buy-with-crypto"||o.id==="buy-with-fiat"?c({id:"select-from-token",backScreen:{id:"main"}}):o.id==="select-from-token"?c(o.backScreen):c({id:"main"})},children:[o.id==="buy-with-crypto"&&u&&t.jsx(ws,{setScreen:c,tokenAmount:j,toChain:y,toToken:x,fromChain:I,fromToken:R,showFromTokenSelector:()=>{c({id:"select-from-token",backScreen:o})},payer:d,client:n,isEmbed:e.isEmbed,onDone:W,payOptions:r,connectLocale:s,connectOptions:e.connectOptions,setPayer:i,activeAccount:u,setTokenAmount:m,setHasEditedAmount:b,disableTokenSelection:O===!0||r.buyWithCrypto!==!1&&((Ze=(Ye=(Qe=r.buyWithCrypto)==null?void 0:Qe.prefillSource)==null?void 0:Ye.allowEdits)==null?void 0:Ze.chain)===!1&&((et=(Xe=(Je=r.buyWithCrypto)==null?void 0:Je.prefillSource)==null?void 0:Xe.allowEdits)==null?void 0:et.token)===!1}),o.id==="buy-with-fiat"&&t.jsx(Jn,{setScreen:c,tokenAmount:j,toChain:y,toToken:x,selectedCurrency:B,client:n,isEmbed:e.isEmbed,onDone:W,payOptions:r,theme:e.theme,showCurrencySelector:()=>{c({id:"select-currency",backScreen:o})},payer:d,setTokenAmount:m,setHasEditedAmount:b}),o.id==="select-from-token"&&f.data&&S&&t.jsx(bs,{fiatSupported:e.payOptions.buyWithFiat!==!1,client:e.client,sourceTokens:S,sourceSupportedTokens:S,toChain:y,toToken:x,tokenAmount:h,mode:r.mode,hiddenWallets:e.hiddenWallets,onConnect:()=>{c({id:"connect-payer-wallet",backScreen:o})},onPayWithFiat:()=>{c({id:"buy-with-fiat"})},onSelectToken:(F,z,_)=>{const Y=F.getAccount();Y&&(i({account:Y,chain:_,wallet:F}),N(z),T(_)),c({id:"buy-with-crypto"})}})]})]})})}function Es(e){const n=()=>{const a=H(Number(e.tokenAmount),6).toString();let s=a.replace(".","").length;return a.includes(".")&&(s+=.3),`calc(${`${Math.max(1,s)}ch + 2px`})`};return t.jsx("div",{children:t.jsxs(l,{flex:"row",gap:"sm",center:"y",style:{justifyContent:"space-between"},children:[t.jsxs(l,{flex:"row",gap:"xxs",center:"y",children:[t.jsx(pt,{variant:"outline",pattern:"^[0-9]*[.,]?[0-9]*$",inputMode:"decimal",tabIndex:-1,placeholder:"0",type:"text","data-placeholder":e.tokenAmount==="",value:e.tokenAmount||"0",disabled:e.disabled,onClick:a=>{e.tokenAmount===""&&a.currentTarget.setSelectionRange(a.currentTarget.value.length,a.currentTarget.value.length)},onChange:a=>{let s=a.target.value;if(s=s.replace(",","."),s.startsWith(".")&&(s=`0${s}`),s.length>10)return;const r=Number(s);Number.isNaN(r)||(s.startsWith("0")&&!s.startsWith("0.")?e.setTokenAmount(s.slice(1)):e.setTokenAmount(s))},style:{border:"none",fontSize:re.lg,boxShadow:"none",borderRadius:"0",padding:"0",paddingBlock:"2px",fontWeight:600,textAlign:"left",width:n()}}),t.jsxs(l,{flex:"row",gap:"xxs",center:"y",children:[t.jsx(se,{token:e.selectedToken,chain:e.selectedChain,size:"md",color:"secondaryText"}),t.jsx(Ct,{chain:e.selectedChain,client:e.client,size:"sm",token:e.selectedToken})]}),t.jsx(qe,{chain:e.selectedChain,client:e.client,tokenAmount:e.tokenAmount,token:e.selectedToken,size:"sm"})]}),t.jsx(En,{chain:e.selectedChain,client:e.client,size:"sm",short:!0})]})})}function Rs(e){var p,b,W,f,v,S,I,T,R,N,B,K;const{setTokenAmount:n,setToChain:a,setToToken:s,setFromChain:r,setFromToken:u,payerAccount:d,client:i,tokenAmount:o,payOptions:c,toToken:h,toChain:m,supportedDestinations:y,enabledPaymentMethods:k}=e,{buyWithCryptoEnabled:j,buyWithFiatEnabled:x}=k,A=!o;switch(c.mode){case"transaction":return t.jsx(Ln,{supportedDestinations:y,payUiOptions:c,payerAccount:d,connectOptions:e.connectOptions,client:i,onContinue:(U,O,$)=>{n(U),a(O),r(O),u($),s($),x&&!j?e.setScreen({id:"buy-with-fiat"}):e.setScreen({id:"select-from-token",backScreen:{id:"main"}})}});case"direct_payment":return t.jsx(_n,{client:i,payUiOptions:c,payerAccount:d,connectOptions:e.connectOptions,supportedDestinations:y,onContinue:(U,O,$)=>{n(U),a(O),r(O),u($),s($),x&&!j?e.setScreen({id:"buy-with-fiat"}):e.setScreen({id:"select-from-token",backScreen:{id:"main"}})}});default:return t.jsxs(l,{px:"lg",children:[t.jsx(g,{y:"lg"}),t.jsx(ne,{title:e.title,onBack:e.onBack}),t.jsx(g,{y:"xl"}),t.jsx(ys,{value:o,onChange:async U=>{e.setHasEditedAmount(!0),n(U)},freezeAmount:((b=(p=c.prefillBuy)==null?void 0:p.allowEdits)==null?void 0:b.amount)===!1,freezeChainAndToken:((f=(W=c.prefillBuy)==null?void 0:W.allowEdits)==null?void 0:f.chain)===!1&&((S=(v=c.prefillBuy)==null?void 0:v.allowEdits)==null?void 0:S.token)===!1||c.buyWithCrypto!==!1&&((R=(T=(I=c.buyWithCrypto)==null?void 0:I.prefillSource)==null?void 0:T.allowEdits)==null?void 0:R.token)===!1&&((K=(B=(N=c.buyWithCrypto)==null?void 0:N.prefillSource)==null?void 0:B.allowEdits)==null?void 0:K.chain)===!1,token:h,chain:m,onSelectToken:e.onSelectBuyToken,client:e.client}),t.jsx(g,{y:"md"}),t.jsx(l,{flex:"column",gap:"sm",children:d?t.jsx(L,{variant:"accent",fullWidth:!0,disabled:A,"data-disabled":A,onClick:()=>{x&&!j?e.setScreen({id:"buy-with-fiat"}):e.setScreen({id:"select-from-token",backScreen:{id:"main"}}),q({event:"choose_payment_method_fund_wallet_mode",client:i,walletAddress:d.address,toChainId:m.id,toToken:D(h)?void 0:h.address})},children:"Continue"}):t.jsx("div",{children:t.jsx(Se,{...e.connectOptions,client:e.client,theme:e.theme,connectButton:{style:{width:"100%"}}})})}),t.jsx(g,{y:"lg"}),c.showThirdwebBranding!==!1&&t.jsxs(t.Fragment,{children:[t.jsx(Fe,{link:"https://playground.thirdweb.com/connect/pay?utm_source=ub_text"}),t.jsx(g,{y:"sm"})]})]})}}function Bs(e){return t.jsxs(l,{children:[t.jsx(l,{p:"lg",children:t.jsx(ne,{title:e.title,onBack:e.onBack})}),t.jsxs(l,{px:"lg",style:{paddingBottom:E.lg},children:[t.jsx(g,{y:"xs"}),t.jsx(Es,{selectedToken:e.selectedToken,selectedChain:e.selectedChain,tokenAmount:e.tokenAmount,setTokenAmount:e.setTokenAmount,client:e.client,disabled:e.disabled}),t.jsx(g,{y:"sm"}),t.jsx(ge,{}),t.jsx(g,{y:"sm"}),e.children]})]})}function ct(e,n,a){if(a)return a;const s={},r=n.buyWithFiat===!1,u=n.buyWithCrypto===!1;for(const d of e)s[d.chain.id]=d.tokens.filter(i=>i.address===In?!1:i.buyWithCryptoEnabled===void 0&&i.buyWithFiatEnabled===void 0||i.buyWithCryptoEnabled&&i.buyWithFiatEnabled?!0:!(!i.buyWithCryptoEnabled&&r||!i.buyWithFiatEnabled&&u));return s}function Fs(e){return t.jsx(Wn,{client:e.client,connectLocale:e.connectLocale,showTabs:!1,onBack:e.goBack,chains:e.chains,closeModal:e.goBack,networkSelector:{renderChain(n){return t.jsx(Dn,{chain:n.chain,confirming:!1,switchingFailed:!1,onClick:()=>{e.setChain(n.chain),e.goBack()},client:e.client,connectLocale:e.connectLocale})}}})}export{qs as default};
